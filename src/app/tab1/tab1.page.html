<ion-content class="ion-no-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="circles"
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>
  <ion-grid>
    <ion-row>
      <ion-col size="12" style="text-align: center;">
        <h3>Realizar venta</h3>
      </ion-col>
    </ion-row>
  </ion-grid>
  <form [formGroup]="formData" (ngSubmit)="sendNewSales()">
    <ion-list style="text-align: center;">
      <ion-item-divider>
        <ion-label>
          Datos del cliente (Opcional)
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label position="floating">Nombre</ion-label>
        <ion-input type="text" formControlName="name" name="name"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Cedula</ion-label>
        <ion-input type="number" formControlName="dni" name="name"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Hospedaje</ion-label>
        <ion-input type="text" formControlName="host" name="host"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Ciudad de Procedencia</ion-label>
        <ion-input type="text" formControlName="citylife" name="citylife"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Telefono</ion-label>
        <ion-input type="number" formControlName="phone" name="phone"></ion-input>
      </ion-item>
      <ion-item-divider>
        <ion-label>
          Vendedor actual
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label position="floating">Vendedor</ion-label>
        <ion-input style="pointer-events:none;" type="text" formControlName="seller" name="seller"></ion-input>
      </ion-item>
      <ion-item-divider>
        <ion-label>
          Servicios a vender
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label>Combo o plan</ion-label>
        <ion-select placeholder="Select One" formControlName="detail" (ionChange)="onChangePlan($event)">
          <ion-select-option *ngFor="let item of data" value="{{item.id}}">{{item.name}}</ion-select-option>
        </ion-select>
      </ion-item>
      <!-- ************************ -->
      <ng-container *ngIf="arraySelectPlan && arraySelectPlan.length > 0">
        <ion-item-divider>
          <ion-label>
            Planes adquiridos
          </ion-label>
        </ion-item-divider>
        <ion-item *ngFor="let item of arraySelectPlan">
          <ion-label>{{item.name}} - {{item.totalvalue}}</ion-label>
          <img (click)="removeItemFromArrPlan(item)" src="https://img.icons8.com/plasticine/2x/delete-sign.png"
            width="20" height="20" style="float: right;">
        </ion-item>
      </ng-container>


      <ion-item>
        <ion-label>Servicios individuales</ion-label>
        <ion-select placeholder="Select One" formControlName="service" (ionChange)="onChange($event)">
          <ion-select-option *ngFor="let item of services" value="{{item.id}}">{{item.name}}</ion-select-option>
        </ion-select>
      </ion-item>
      <!-- @@@@@@@@@@@@@@@@@@@@@@@@@ -->
      <ng-container *ngIf="arraySelect && arraySelect.length > 0">
        <ion-item-divider>
          <ion-label>
            Servicios adquiridos
          </ion-label>
        </ion-item-divider>
        <ion-item *ngFor="let item of arraySelect">
          <ion-label>{{item.name}} - {{item.publicvalue}}</ion-label><img (click)="removeItemFromArr(item)"
            src="https://img.icons8.com/plasticine/2x/delete-sign.png" width="20" height="20" style="float: right;">
        </ion-item>
      </ng-container>
      <ion-item>
        <ion-label>Zona de venta</ion-label>
        <ion-select placeholder="Select One" formControlName="zone">
          <ion-select-option *ngFor="let item of pointsale" value="{{item.name}}">{{item.name}}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item-divider>
        <ion-label>
          Escanear codigo de manilla
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label>Escanear codigo:</ion-label>
        <ion-input type="text" formControlName="codebar" name="codebar"></ion-input>
        <ion-button color="danger" (click)="addCodeManula()">Añadir</ion-button>

        <ion-button color="warning" (click)="scanCode()">SCAN</ion-button>

      </ion-item>
      <ion-button color="danger" (click)="addRangeCodes()">Generar Consecutivos</ion-button>

      <br>
      <ng-container *ngIf="scannedData.length > 0">
        <p>Numero de Codigos añadidos: {{ scannedData.length }}</p>
        <div class="codebox">
          <p *ngFor="let item of scannedData">
            <img width="22" height="22"
              src="https://images.vexels.com/media/users/3/157862/isolated/preview/5fc76d9e8d748db3089a489cdd492d4b-barcode-scanning-icon-by-vexels.png"
              alt=""> &nbsp; {{ item }}
            <img (click)="removeItemFromArrCodeBar(item)" src="https://img.icons8.com/plasticine/2x/delete-sign.png"
              width="20" height="20" style="float: right;">
          </p>
        </div>

      </ng-container>
      <br>
      <ion-button color="primary" (click)="resetForm()">Limpiar</ion-button>
      <ion-button color="dark" type="submit">Guardar</ion-button>
      <ion-item>
        <ion-label *ngIf="scannedData.length > 0">Total: {{(totalValue + total) * scannedData.length }} </ion-label>
        <ion-label *ngIf="scannedData.length === 0">Total: {{(totalValue + total) }} </ion-label>
      </ion-item>
    </ion-list>
  </form>
</ion-content>